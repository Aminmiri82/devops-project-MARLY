<svg contentStyleType='text/css' data-diagram-type='SEQUENCE' height='727px' preserveAspectRatio='none' style='width:1405px;height:727px;background:#FFFFFF;' version='1.1' viewBox='0 0 1405 727' width='1405px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' zoomAndPan='magnify'><defs/><g><g><title>User</title><rect fill='#000000' fill-opacity='0.00000' height='565.7891' width='8' x='19.9551' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='23' x2='23' y1='81.2969' y2='647.0859'/></g><g><title>Frontend</title><rect fill='#000000' fill-opacity='0.00000' height='565.7891' width='8' x='208.7339' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='212.1792' x2='212.1792' y1='81.2969' y2='647.0859'/></g><g><title>Google OAuth</title><rect fill='#000000' fill-opacity='0.00000' height='565.7891' width='8' x='505.522' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='508.6963' x2='508.6963' y1='81.2969' y2='647.0859'/></g><g><title>GoogleTasksController</title><rect fill='#000000' fill-opacity='0.00000' height='565.7891' width='8' x='732.2407' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='736.0566' x2='736.0566' y1='81.2969' y2='647.0859'/></g><g><title>UserService</title><rect fill='#000000' fill-opacity='0.00000' height='565.7891' width='8' x='1044.418' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='1047.5923' x2='1047.5923' y1='81.2969' y2='647.0859'/></g><g><title>OAuth2AuthorizedClientService</title><rect fill='#000000' fill-opacity='0.00000' height='565.7891' width='8' x='1220.6851' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='1224.2437' x2='1224.2437' y1='81.2969' y2='647.0859'/></g><g><title>DB</title><rect fill='#000000' fill-opacity='0.00000' height='565.7891' width='8' x='1366.1265' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='1370.1265' x2='1370.1265' y1='81.2969' y2='647.0859'/></g><g class='participant participant-head' data-participant='User'><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='31.9102' x='5' y='77.9951'>User</text><ellipse cx='23.9551' cy='13.5' fill='#E2E2F0' rx='8' ry='8' style='stroke:#181818;stroke-width:0.5;'/><path d='M23.9551,21.5 L23.9551,48.5 M10.9551,29.5 L36.9551,29.5 M23.9551,48.5 L10.9551,63.5 M23.9551,48.5 L36.9551,63.5' fill='none' style='stroke:#181818;stroke-width:0.5;'/></g><g class='participant participant-tail' data-participant='User'><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='31.9102' x='5' y='659.0811'>User</text><ellipse cx='23.9551' cy='670.8828' fill='#E2E2F0' rx='8' ry='8' style='stroke:#181818;stroke-width:0.5;'/><path d='M23.9551,678.8828 L23.9551,705.8828 M10.9551,686.8828 L36.9551,686.8828 M23.9551,705.8828 L10.9551,720.8828 M23.9551,705.8828 L36.9551,720.8828' fill='none' style='stroke:#181818;stroke-width:0.5;'/></g><g class='participant participant-head' data-participant='Frontend'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='77.1094' x='174.1792' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='63.1094' x='181.1792' y='69.9951'>Frontend</text></g><g class='participant participant-tail' data-participant='Frontend'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='77.1094' x='174.1792' y='646.0859'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='63.1094' x='181.1792' y='666.0811'>Frontend</text></g><g class='participant participant-head' data-participant='OAuth'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='111.6514' x='453.6963' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='97.6514' x='460.6963' y='69.9951'>Google OAuth</text></g><g class='participant participant-tail' data-participant='OAuth'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='111.6514' x='453.6963' y='646.0859'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='97.6514' x='460.6963' y='666.0811'>Google OAuth</text></g><g class='participant participant-head' data-participant='GoogleTasksController'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='172.3682' x='650.0566' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='158.3682' x='657.0566' y='69.9951'>GoogleTasksController</text></g><g class='participant participant-tail' data-participant='GoogleTasksController'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='172.3682' x='650.0566' y='646.0859'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='158.3682' x='657.0566' y='666.0811'>GoogleTasksController</text></g><g class='participant participant-head' data-participant='UserService'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='97.6514' x='999.5923' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='83.6514' x='1006.5923' y='69.9951'>UserService</text></g><g class='participant participant-tail' data-participant='UserService'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='97.6514' x='999.5923' y='646.0859'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='83.6514' x='1006.5923' y='666.0811'>UserService</text></g><g class='participant participant-head' data-participant='OAuth2AuthorizedClientService'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='234.8828' x='1107.2437' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='220.8828' x='1114.2437' y='69.9951'>OAuth2AuthorizedClientService</text></g><g class='participant participant-tail' data-participant='OAuth2AuthorizedClientService'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='234.8828' x='1107.2437' y='646.0859'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='220.8828' x='1114.2437' y='666.0811'>OAuth2AuthorizedClientService</text></g><g class='participant participant-head' data-participant='DB'><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='20.3848' x='1356.9341' y='77.9951'>DB</text><path d='M1352.1265,29 C1352.1265,19 1370.1265,19 1370.1265,19 C1370.1265,19 1388.1265,19 1388.1265,29 L1388.1265,55 C1388.1265,65 1370.1265,65 1370.1265,65 C1370.1265,65 1352.1265,65 1352.1265,55 L1352.1265,29' fill='#E2E2F0' style='stroke:#181818;stroke-width:1.5;'/><path d='M1352.1265,29 C1352.1265,39 1370.1265,39 1370.1265,39 C1370.1265,39 1388.1265,39 1388.1265,29' fill='none' style='stroke:#181818;stroke-width:1.5;'/></g><g class='participant participant-tail' data-participant='DB'><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='20.3848' x='1356.9341' y='659.0811'>DB</text><path d='M1352.1265,672.3828 C1352.1265,662.3828 1370.1265,662.3828 1370.1265,662.3828 C1370.1265,662.3828 1388.1265,662.3828 1388.1265,672.3828 L1388.1265,698.3828 C1388.1265,708.3828 1370.1265,708.3828 1370.1265,708.3828 C1370.1265,708.3828 1352.1265,708.3828 1352.1265,698.3828 L1352.1265,672.3828' fill='#E2E2F0' style='stroke:#181818;stroke-width:1.5;'/><path d='M1352.1265,672.3828 C1352.1265,682.3828 1370.1265,682.3828 1370.1265,682.3828 C1370.1265,682.3828 1388.1265,682.3828 1388.1265,672.3828' fill='none' style='stroke:#181818;stroke-width:1.5;'/></g><g class='message' data-participant-1='User' data-participant-2='Frontend'><polygon fill='#181818' points='200.7339,108.4297,210.7339,112.4297,200.7339,116.4297,204.7339,112.4297' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='23.9551' x2='206.7339' y1='112.4297' y2='112.4297'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='164.7788' x='30.9551' y='107.3638'>Click "Link Google Tasks"</text></g><g class='message' data-participant-1='Frontend' data-participant-2='Frontend'><line style='stroke:#181818;stroke-width:1;' x1='212.7339' x2='254.7339' y1='156.6953' y2='156.6953'/><line style='stroke:#181818;stroke-width:1;' x1='254.7339' x2='254.7339' y1='156.6953' y2='169.6953'/><line style='stroke:#181818;stroke-width:1;' x1='213.7339' x2='254.7339' y1='169.6953' y2='169.6953'/><polygon fill='#181818' points='223.7339,165.6953,213.7339,169.6953,223.7339,173.6953,219.7339,169.6953' style='stroke:#181818;stroke-width:1;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='280.0396' x='219.7339' y='136.4966'>window.open(/oauth2/authorization/google</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='282.7881' x='219.7339' y='151.6294'>?redirect=/api/google/tasks/link?userId=...)</text></g><g class='message' data-participant-1='Frontend' data-participant-2='OAuth'><polygon fill='#181818' points='497.522,194.8281,507.522,198.8281,497.522,202.8281,501.522,198.8281' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='212.7339' x2='503.522' y1='198.8281' y2='198.8281'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='121.6401' x='219.7339' y='193.7622'>Redirect to Google</text></g><g class='message' data-participant-1='OAuth' data-participant-2='User'><polygon fill='#181818' points='34.9551,223.9609,24.9551,227.9609,34.9551,231.9609,30.9551,227.9609' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='28.9551' x2='508.522' y1='227.9609' y2='227.9609'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='86.9946' x='40.9551' y='222.895'>Login prompt</text></g><g class='message' data-participant-1='User' data-participant-2='OAuth'><polygon fill='#181818' points='497.522,253.0938,507.522,257.0938,497.522,261.0938,501.522,257.0938' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='23.9551' x2='503.522' y1='257.0938' y2='257.0938'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='219.0513' x='30.9551' y='252.0278'>Authenticate &amp; grant permissions</text></g><g class='message' data-participant-1='OAuth' data-participant-2='GoogleTasksController'><polygon fill='#181818' points='724.2407,297.3594,734.2407,301.3594,724.2407,305.3594,728.2407,301.3594' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='509.522' x2='730.2407' y1='301.3594' y2='301.3594'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='202.7188' x='516.522' y='281.1606'>Callback: GET /link?userId=xxx</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='146.4531' x='516.522' y='296.2935'>(with OAuth2Principal)</text></g><g class='message' data-participant-1='GoogleTasksController' data-participant-2='UserService'><polygon fill='#181818' points='1036.418,326.4922,1046.418,330.4922,1036.418,334.4922,1040.418,330.4922' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='736.2407' x2='1042.418' y1='330.4922' y2='330.4922'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='288.1772' x='743.2407' y='325.4263'>linkGoogleAccount(userId, {subject, email})</text></g><g class='message' data-participant-1='UserService' data-participant-2='DB'><polygon fill='#181818' points='1358.1265,355.625,1368.1265,359.625,1358.1265,363.625,1362.1265,359.625' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='1048.418' x2='1364.1265' y1='359.625' y2='359.625'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='229.0361' x='1055.418' y='354.5591'>Update user.googleAccountSubject</text></g><g class='message' data-participant-1='UserService' data-participant-2='OAuth2AuthorizedClientService'><polygon fill='#181818' points='1212.6851,399.8906,1222.6851,403.8906,1212.6851,407.8906,1216.6851,403.8906' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='1048.418' x2='1218.6851' y1='403.8906' y2='403.8906'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='148.1416' x='1055.418' y='383.6919'>Store authorized client</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='132.4565' x='1055.418' y='398.8247'>(principal = subject)</text></g><g class='message' data-participant-1='UserService' data-participant-2='GoogleTasksController'><polygon fill='#181818' points='747.2407,429.0234,737.2407,433.0234,747.2407,437.0234,743.2407,433.0234' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;' x1='741.2407' x2='1047.418' y1='433.0234' y2='433.0234'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='89.0957' x='753.2407' y='427.9575'>Updated User</text></g><g class='message' data-participant-1='GoogleTasksController' data-participant-2='Frontend'><polygon fill='#181818' points='223.7339,473.2891,213.7339,477.2891,223.7339,481.2891,219.7339,477.2891' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;' x1='217.7339' x2='735.2407' y1='477.2891' y2='477.2891'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='127.7593' x='229.7339' y='457.0903'>HTML success page</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='141.2354' x='229.7339' y='472.2231'>+ postMessage event</text></g><g class='message' data-participant-1='Frontend' data-participant-2='Frontend'><line style='stroke:#181818;stroke-width:1;' x1='212.7339' x2='254.7339' y1='521.5547' y2='521.5547'/><line style='stroke:#181818;stroke-width:1;' x1='254.7339' x2='254.7339' y1='521.5547' y2='534.5547'/><line style='stroke:#181818;stroke-width:1;' x1='213.7339' x2='254.7339' y1='534.5547' y2='534.5547'/><polygon fill='#181818' points='223.7339,530.5547,213.7339,534.5547,223.7339,538.5547,219.7339,534.5547' style='stroke:#181818;stroke-width:1;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='80.4946' x='219.7339' y='501.356'>Close popup</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='165.1406' x='219.7339' y='516.4888'>Receive link confirmation</text></g><g class='message' data-participant-1='Frontend' data-participant-2='User'><polygon fill='#181818' points='34.9551,559.6875,24.9551,563.6875,34.9551,567.6875,30.9551,563.6875' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='28.9551' x2='211.7339' y1='563.6875' y2='563.6875'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='147.5005' x='40.9551' y='558.6216'>"Google Tasks linked!"</text></g><path d='M186,576.6875 L186,631.6875 L1394,631.6875 L1394,586.6875 L1384,576.6875 L186,576.6875' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><path d='M1384,576.6875 L1384,586.6875 L1394,586.6875 L1384,576.6875' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='157.3774' x='508.1304' y='593.7544'>Future task fetches use:</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='211.9229' x='508.1304' y='608.8872'>OAuth2AuthorizedClient client =</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='547.4219' x='516.395' y='624.02'>authorizedClientService.loadAuthorizedClient("google", user.googleAccountSubject)</text></g></svg>