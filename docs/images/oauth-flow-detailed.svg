<svg contentStyleType='text/css' data-diagram-type='SEQUENCE' height='744px' preserveAspectRatio='none' style='width:1349px;height:744px;background:#FFFFFF;' version='1.1' viewBox='0 0 1349 744' width='1349px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' zoomAndPan='magnify'><defs/><g><g><title>User</title><rect fill='#000000' fill-opacity='0.00000' height='581.9219' width='8' x='19.9551' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='23' x2='23' y1='81.2969' y2='663.2188'/></g><g><title>Frontend</title><rect fill='#000000' fill-opacity='0.00000' height='581.9219' width='8' x='208.7339' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='212.1792' x2='212.1792' y1='81.2969' y2='663.2188'/></g><g><title>Spring Security</title><rect fill='#000000' fill-opacity='0.00000' height='581.9219' width='8' x='530.6548' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='534.0952' x2='534.0952' y1='81.2969' y2='663.2188'/></g><g><title>Google OAuth</title><rect fill='#000000' fill-opacity='0.00000' height='581.9219' width='8' x='750.4038' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='753.5781' x2='753.5781' y1='81.2969' y2='663.2188'/></g><g><title>GoogleTasksController</title><rect fill='#000000' fill-opacity='0.00000' height='581.9219' width='8' x='902.4136' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='906.2295' x2='906.2295' y1='81.2969' y2='663.2188'/></g><g><title>OAuth2AuthorizedClientService</title><rect fill='#000000' fill-opacity='0.00000' height='581.9219' width='8' x='1116.0391' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='1119.5977' x2='1119.5977' y1='81.2969' y2='663.2188'/></g><g><title>DB</title><rect fill='#000000' fill-opacity='0.00000' height='581.9219' width='8' x='1261.4805' y='81.2969'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='1265.4805' x2='1265.4805' y1='81.2969' y2='663.2188'/></g><g class='participant participant-head' data-participant='User'><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='31.9102' x='5' y='77.9951'>User</text><ellipse cx='23.9551' cy='13.5' fill='#E2E2F0' rx='8' ry='8' style='stroke:#181818;stroke-width:0.5;'/><path d='M23.9551,21.5 L23.9551,48.5 M10.9551,29.5 L36.9551,29.5 M23.9551,48.5 L10.9551,63.5 M23.9551,48.5 L36.9551,63.5' fill='none' style='stroke:#181818;stroke-width:0.5;'/></g><g class='participant participant-tail' data-participant='User'><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='31.9102' x='5' y='675.2139'>User</text><ellipse cx='23.9551' cy='687.0156' fill='#E2E2F0' rx='8' ry='8' style='stroke:#181818;stroke-width:0.5;'/><path d='M23.9551,695.0156 L23.9551,722.0156 M10.9551,703.0156 L36.9551,703.0156 M23.9551,722.0156 L10.9551,737.0156 M23.9551,722.0156 L36.9551,737.0156' fill='none' style='stroke:#181818;stroke-width:0.5;'/></g><g class='participant participant-head' data-participant='FE'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='77.1094' x='174.1792' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='63.1094' x='181.1792' y='69.9951'>Frontend</text></g><g class='participant participant-tail' data-participant='FE'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='77.1094' x='174.1792' y='662.2188'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='63.1094' x='181.1792' y='682.2139'>Frontend</text></g><g class='participant participant-head' data-participant='SS'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='121.1191' x='474.0952' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='107.1191' x='481.0952' y='69.9951'>Spring Security</text></g><g class='participant participant-tail' data-participant='SS'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='121.1191' x='474.0952' y='662.2188'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='107.1191' x='481.0952' y='682.2139'>Spring Security</text></g><g class='participant participant-head' data-participant='Google'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='111.6514' x='698.5781' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='97.6514' x='705.5781' y='69.9951'>Google OAuth</text></g><g class='participant participant-tail' data-participant='Google'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='111.6514' x='698.5781' y='662.2188'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='97.6514' x='705.5781' y='682.2139'>Google OAuth</text></g><g class='participant participant-head' data-participant='GTC'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='172.3682' x='820.2295' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='158.3682' x='827.2295' y='69.9951'>GoogleTasksController</text></g><g class='participant participant-tail' data-participant='GTC'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='172.3682' x='820.2295' y='662.2188'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='158.3682' x='827.2295' y='682.2139'>GoogleTasksController</text></g><g class='participant participant-head' data-participant='OACS'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='234.8828' x='1002.5977' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='220.8828' x='1009.5977' y='69.9951'>OAuth2AuthorizedClientService</text></g><g class='participant participant-tail' data-participant='OACS'><rect fill='#E2E2F0' height='30.2969' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='234.8828' x='1002.5977' y='662.2188'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='220.8828' x='1009.5977' y='682.2139'>OAuth2AuthorizedClientService</text></g><g class='participant participant-head' data-participant='DB'><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='20.3848' x='1252.2881' y='77.9951'>DB</text><path d='M1247.4805,29 C1247.4805,19 1265.4805,19 1265.4805,19 C1265.4805,19 1283.4805,19 1283.4805,29 L1283.4805,55 C1283.4805,65 1265.4805,65 1265.4805,65 C1265.4805,65 1247.4805,65 1247.4805,55 L1247.4805,29' fill='#E2E2F0' style='stroke:#181818;stroke-width:1.5;'/><path d='M1247.4805,29 C1247.4805,39 1265.4805,39 1265.4805,39 C1265.4805,39 1283.4805,39 1283.4805,29' fill='none' style='stroke:#181818;stroke-width:1.5;'/></g><g class='participant participant-tail' data-participant='DB'><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='20.3848' x='1252.2881' y='675.2139'>DB</text><path d='M1247.4805,688.5156 C1247.4805,678.5156 1265.4805,678.5156 1265.4805,678.5156 C1265.4805,678.5156 1283.4805,678.5156 1283.4805,688.5156 L1283.4805,714.5156 C1283.4805,724.5156 1265.4805,724.5156 1265.4805,724.5156 C1265.4805,724.5156 1247.4805,724.5156 1247.4805,714.5156 L1247.4805,688.5156' fill='#E2E2F0' style='stroke:#181818;stroke-width:1.5;'/><path d='M1247.4805,688.5156 C1247.4805,698.5156 1265.4805,698.5156 1265.4805,698.5156 C1265.4805,698.5156 1283.4805,698.5156 1283.4805,688.5156' fill='none' style='stroke:#181818;stroke-width:1.5;'/></g><g class='message' data-participant-1='User' data-participant-2='FE'><polygon fill='#181818' points='200.7339,108.4297,210.7339,112.4297,200.7339,116.4297,204.7339,112.4297' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='23.9551' x2='206.7339' y1='112.4297' y2='112.4297'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='164.7788' x='30.9551' y='107.3638'>Click "Link Google Tasks"</text></g><g class='message' data-participant-1='FE' data-participant-2='SS'><polygon fill='#181818' points='522.6548,152.6953,532.6548,156.6953,522.6548,160.6953,526.6548,156.6953' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='212.7339' x2='528.6548' y1='156.6953' y2='156.6953'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='264.8687' x='219.7339' y='136.4966'>Redirect to /oauth2/authorization/google</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='297.9209' x='219.7339' y='151.6294'>?redirect_uri=/api/google/tasks/link?userId=X</text></g><g class='message' data-participant-1='SS' data-participant-2='Google'><polygon fill='#181818' points='742.4038,196.9609,752.4038,200.9609,742.4038,204.9609,746.4038,200.9609' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='534.6548' x2='748.4038' y1='200.9609' y2='200.9609'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='140.9053' x='541.6548' y='180.7622'>Authorization request</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='184.647' x='541.6548' y='195.895'>(scope: tasks, profile, email)</text></g><g class='message' data-participant-1='Google' data-participant-2='User'><polygon fill='#181818' points='34.9551,226.0938,24.9551,230.0938,34.9551,234.0938,30.9551,230.0938' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='28.9551' x2='753.4038' y1='230.0938' y2='230.0938'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='152.7817' x='40.9551' y='225.0278'>Login &amp; consent screen</text></g><g class='message' data-participant-1='User' data-participant-2='Google'><polygon fill='#181818' points='742.4038,255.2266,752.4038,259.2266,742.4038,263.2266,746.4038,259.2266' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='23.9551' x2='748.4038' y1='259.2266' y2='259.2266'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='118.8472' x='30.9551' y='254.1606'>Grant permissions</text></g><g class='message' data-participant-1='Google' data-participant-2='SS'><polygon fill='#181818' points='545.6548,284.3594,535.6548,288.3594,545.6548,292.3594,541.6548,288.3594' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='539.6548' x2='753.4038' y1='288.3594' y2='288.3594'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='179.918' x='551.6548' y='283.2935'>Authorization code callback</text></g><g class='message' data-participant-1='SS' data-participant-2='Google'><polygon fill='#181818' points='742.4038,313.4922,752.4038,317.4922,742.4038,321.4922,746.4038,317.4922' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='534.6548' x2='748.4038' y1='317.4922' y2='317.4922'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='168.9619' x='541.6548' y='312.4263'>Exchange code for tokens</text></g><g class='message' data-participant-1='Google' data-participant-2='SS'><polygon fill='#181818' points='545.6548,342.625,535.6548,346.625,545.6548,350.625,541.6548,346.625' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;' x1='539.6548' x2='753.4038' y1='346.625' y2='346.625'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='195.749' x='551.6548' y='341.5591'>Access token + Refresh token</text></g><g class='message' data-participant-1='SS' data-participant-2='GTC'><polygon fill='#181818' points='894.4136,386.8906,904.4136,390.8906,894.4136,394.8906,898.4136,390.8906' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='534.6548' x2='900.4136' y1='390.8906' y2='390.8906'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='154.2607' x='541.6548' y='370.6919'>Continue to redirect_uri</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='146.4531' x='541.6548' y='385.8247'>(with OAuth2Principal)</text></g><g class='message' data-participant-1='GTC' data-participant-2='GTC'><line style='stroke:#181818;stroke-width:1;' x1='906.4136' x2='948.4136' y1='420.0234' y2='420.0234'/><line style='stroke:#181818;stroke-width:1;' x1='948.4136' x2='948.4136' y1='420.0234' y2='433.0234'/><line style='stroke:#181818;stroke-width:1;' x1='907.4136' x2='948.4136' y1='433.0234' y2='433.0234'/><polygon fill='#181818' points='917.4136,429.0234,907.4136,433.0234,917.4136,437.0234,913.4136,433.0234' style='stroke:#181818;stroke-width:1;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='192.6514' x='913.4136' y='414.9575'>Extract subject from principal</text></g><g class='message' data-participant-1='GTC' data-participant-2='DB'><polygon fill='#181818' points='1253.4805,458.1563,1263.4805,462.1563,1253.4805,466.1563,1257.4805,462.1563' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='906.4136' x2='1259.4805' y1='462.1563' y2='462.1563'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='295.312' x='913.4136' y='457.0903'>Update user.googleAccountSubject = subject</text></g><g class='message' data-participant-1='GTC' data-participant-2='OACS'><polygon fill='#181818' points='1108.0391,502.4219,1118.0391,506.4219,1108.0391,510.4219,1112.0391,506.4219' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='906.4136' x2='1114.0391' y1='506.4219' y2='506.4219'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='148.1416' x='913.4136' y='486.2231'>Store authorized client</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='132.4565' x='913.4136' y='501.356'>(principal = subject)</text></g><g class='message' data-participant-1='GTC' data-participant-2='FE'><polygon fill='#181818' points='223.7339,531.5547,213.7339,535.5547,223.7339,539.5547,219.7339,535.5547' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;' x1='217.7339' x2='905.4136' y1='535.5547' y2='535.5547'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='196.8472' x='229.7339' y='530.4888'>Success HTML + postMessage</text></g><g class='message' data-participant-1='FE' data-participant-2='User'><polygon fill='#181818' points='34.9551,560.6875,24.9551,564.6875,34.9551,568.6875,30.9551,564.6875' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='28.9551' x2='211.7339' y1='564.6875' y2='564.6875'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='147.5005' x='40.9551' y='559.6216'>"Google Tasks linked!"</text></g><path d='M1041,577.6875 L1041,647.6875 L1342,647.6875 L1342,587.6875 L1332,577.6875 L1041,577.6875' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><path d='M1332,577.6875 L1332,587.6875 L1342,587.6875 L1332,577.6875' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='241.103' x='1047' y='594.7544'>Tokens are stored by Spring Security</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='280.5283' x='1047' y='609.8872'>and automatically refreshed when expired.</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='254.7949' x='1047' y='625.02'>The subject (Google user ID) is used as</text><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='236.1519' x='1047' y='640.1528'>the principal name for client lookup.</text></g></svg>